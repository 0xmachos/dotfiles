#!/usr/bin/env bash
# dotfiles/.functions


function update! {

  # Update Homebrew, LaTeX packages and macOS

  echo "[âš ï¸ ] Updating brew, LaTeX, pip3, Ruby Gems & macOS"
  sudo -v

  if [ -x "/usr/local/bin/brew" ]; then
    echo "[ðŸº] Updating brew"
    brew update
    brew upgrade
    brew cleanup
  fi

  if [ -x "$(command -v tlmgr)" ]; then
    echo "[ðŸ“] Updating LaTeX"
    sudo tlmgr update --self
    sudo tlmgr update â€“all
  fi

  if [ -x "$(command -v pip3)" ]; then
    echo "[ðŸ] Updating pip3"
    pip3 install --upgrade pip
  fi

  if [ -x "/usr/local/opt/ruby/bin/gem" ]; then
    echo "[ðŸ’Ž] Updating Ruby Gems"
    /usr/local/opt/ruby/bin/gem update
    /usr/local/opt/ruby/bin/gem cleanup
  fi

  if [[ "${OS}" == "Darwin" ]]; then
    echo "[ðŸŽ] Updating macOS"
    softwareupdate -i -a
  fi

  if [[ "${OS}" == "Linux" ]]; then
    echo "[ðŸ§] Updating Linux"
    if [ -x "$(command -v apt-get)" ]; then
      sudo apt-get update
      sudo apt-get upgrade -y
      sudo apt-get autoclean -y
      sudo apt-get autoremove -y
    
    elif [ -x "$(command -v yum)" ]; then
      sudo yum update
    fi
  fi
}


function git-clean {

  # Run git garbage collection in all my git repos

  declare -a dirs

  for dir in "/Users/${USER}/Documents/Projects/"*; do
    dirs+=("${dir}"); 
  done

  echo "[â™»ï¸] Garbage Collecting in Git Repos..."
  
  for dir in "${dirs[@]}"; do
    ( # SUBSHELL
      cd "${dir}" || exit
      if [ -d .git ]; then
        echo "  Cleaning: ${BOLD}$(basename ${dir})${RESET}"
        git gc --aggressive --quiet >/dev/null
        # git fsck --full >/dev/null 2>&1
      fi
    )
  done  
}
