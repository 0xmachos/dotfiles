#!/usr/bin/env bash
# dotfiles/.functions


function update! {

  # Update Homebrew, LaTeX packages and macOS

  echo "[âš ï¸ ] Updating brew, LaTeX, pip3, Ruby Gems & macOS"
  sudo -v

  if [ -x "/usr/local/bin/brew" ]; then
    echo "[ğŸº] Updating brew"
    brew update
    brew upgrade
    brew cleanup
    brew file init -y 
  fi

  if [ -x "$(command -v tlmgr)" ]; then
    echo "[ğŸ“] Updating LaTeX"
    sudo tlmgr update --self
    sudo tlmgr update â€“all
  fi

  if [ -x "$(command -v pip3)" ]; then
    echo "[ğŸ] Updating pip3"
    pip3 install --upgrade pip
  fi

  if [ -x "/usr/local/opt/ruby/bin/gem" ]; then
    echo "[ğŸ’] Updating Ruby Gems"
    gem update
    gem cleanup
  fi

  if [[ "${OS}" == "Darwin" ]]; then
    echo "[ğŸ] Updating macOS"
    softwareupdate -i -a
  fi

  if [[ "${OS}" == "Linux" ]]; then
    echo "[ğŸ§] Updating Linux"
    if [ -x "$(command -v apt-get)" ]; then
      sudo apt-get update
      sudo apt-get upgrade -y
      sudo apt-get autoclean -y
      sudo apt-get autoremove -y
    
    elif [ -x "$(command -v yum)" ]; then
      sudo yum update
    fi
  fi
}


function git-clean {

  # Run git garbage collection in all my git repos

  declare -a dirs
  local repo_name

  while IFS=$'\n' read -r dir; do 
    dirs+=("${dir}"); 
  done < <(find "$HOME" -type d -maxdepth 4)

  echo "[â™»ï¸] Garbage Collecting in Git Repos..."
  
  for dir in "${dirs[@]}"; do
    ( # SUBSHELL
      cd "${dir}" || exit
      if [ -d .git ]; then
        repo_name=$(basename "${dir}")
        echo "  Cleaning: ${BOLD}${repo_name}${RESET}"
        git gc --aggressive --quiet >/dev/null
        # git fsck --full >/dev/null 2>&1
      fi
    )
  done  
}


function jek {

  # Start local Jeklly instance

  if ! bundle exec jekyll serve; then 
    bundle install
    bundle exec jekyll serve
  fi
}

