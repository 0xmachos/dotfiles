#!/usr/bin/env zsh
# dotfiles/.functions/jump

function jump {
  # jump
  #   Update macOS, Homebrew, LaTeX packages & XProtect
  #   Run XProtect scan

  local -r SUDO_BINARY="/usr/bin/sudo"
  local -r SWUPDATE_BINARY="/usr/sbin/softwareupdate"
  local -r BREW_BINARY="/opt/homebrew/bin/brew"
  local -r TLMGR_BINARY="/Library/TeX/texbin/tlmgr"
  local -r XPROTECT_BINARY="/usr/bin/xprotect"
  local -r XPROTECT_APP="/Library/Apple/System/Library/CoreServices/XProtect.app/Contents/MacOS/XProtect"


  ## macOS ##
  if ! [[ -x "${SWUPDATE_BINARY}" ]]; then
    echo "Cannot execute /usr/sbin/softwareupdate"
    return 1
  fi

  echo "[üçé] Updating macOS..."
  "${SWUPDATE_BINARY}" --install --all --include-config-data


  ## Homebrew ##
  if [[ -x "${BREW_BINARY}" ]]; then
    echo "[üç∫] Updating Homebrew..."
    if "${BREW_BINARY}" update; then
      "${BREW_BINARY}" upgrade
      "${BREW_BINARY}" cleanup
      "${BREW_BINARY}" autoremove
      "${BREW_BINARY}" doctor
    else
      echo "[‚ùå] Failed to update Homebrew"
    fi
  fi


  ## LaTeX ##
  if [[ -x "${TLMGR_BINARY}" ]]; then
    "${SUDO_BINARY}" --prompt="[‚ö†Ô∏è ] Password required to run tlmgr: " -v
    echo "[üìù] Updating LaTeX..."
    "${SUDO_BINARY}" "${TLMGR_BINARY}" update --self
    "${SUDO_BINARY}" "${TLMGR_BINARY}" update --all
  fi

  ## XProtect ##
  if [[ -x "${XPROTECT_BINARY}" ]]; then
    echo "[üõ°Ô∏è] Updating XProtect..."
    "${SUDO_BINARY}" --prompt="[‚ö†Ô∏è ] Password required to update XProtect: " -v
    "${SUDO_BINARY}" "${XPROTECT_BINARY}" update --prerelease
  fi

  if [[ -x "${XPROTECT_APP}" ]]; then
    echo "[üîç] Running XProtect scan in the background..."
    "${XPROTECT_APP}" &
  fi
}
